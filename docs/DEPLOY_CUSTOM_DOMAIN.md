# Кастомный домен на Vercel — если не грузятся стили/скрипты

Если на **weddings-git-main-sharky121s-projects.vercel.app** всё открывается, а на **свадьба-в-усадьбе-ушмор.рф** ресурсы не грузятся (таймаут на `/_next/static`), статику нужно отдавать с рабочего домена Vercel.

## Решение для .рф (без переменных окружения)

В **next.config.ts** задан фиксированный `assetPrefix`: скрипты и стили всегда грузятся с `https://weddings-git-main-sharky121s-projects.vercel.app`. Сборка не зависит от переменных окружения. Если изменится URL деплоя на Vercel — поправьте этот URL в конфиге.

---

## Шаг 1: Проверка, что переменная попала в сборку

1. Откройте сайт по кастомному домену (https://свадьба-в-усадьбе-ушмор.рф).
2. Правый клик → **Просмотр кода страницы** (View Page Source).
3. Найдите в HTML ссылку на скрипт, например `_next/static/chunks/` или `_next/static/css/`.
4. Посмотрите, с какого URL они идут:
   - Если **https://свадьба-в-усадьбе-ушмор.рф/...** или **https://xn----...xn--p1ai/...** — переменная в сборке учтена, проблема в сети/DNS/SSL до этого домена.
   - Если **https://ваш-проект.vercel.app/...** — в сборке использовался рабочий домен; проверьте, что **NEXT_PUBLIC_SITE_URL** задана для **Production** и сделан **Redeploy после добавления переменной**.

## Шаг 2: Задать NEXT_PUBLIC_SITE_URL и пересобрать

1. Vercel → проект → **Settings** → **Environment Variables**.
2. Добавьте:
   - **Name:** `NEXT_PUBLIC_SITE_URL`
   - **Value:** `https://свадьба-в-усадьбе-ушмор.рф` (без `/` в конце)
   - Отметьте **Production** (галочка для Production обязательна).
3. **Сохраните** переменную.
4. **Deployments** → у последнего деплоя меню (три точки) → **Redeploy** (без кэша, если есть опция). Важно: новая сборка должна запуститься уже с этой переменной.

Если после этого в коде страницы (п. 1) ассеты по-прежнему с vercel.app — переменная не попала в сборку (другой тип окружения или старый кэш). Удалите переменную, сохраните, добавьте снова, снова сохраните и заново сделайте Redeploy.

## Шаг 3: Попробовать punycode вместо кириллицы

Иногда на сборке или CDN некорректно обрабатывается кириллический URL в переменной. Задайте **NEXT_PUBLIC_SITE_URL** в виде punycode:

1. Переведите домен в punycode, например на [punycoder.com](https://www.punycoder.com/) или [dnschecker.org/idn-punycode-converter](https://dnschecker.org/idn-punycode-converter.php):  
   `свадьба-в-усадьбе-ушмор.рф` → получится что-то вроде `xn----8sbalcbagb2aibnqeqc2a4c.xn--p1ai`.
2. В Vercel в **NEXT_PUBLIC_SITE_URL** укажите:  
   `https://ВАШ-PUNYCODE.xn--p1ai` (подставьте punycode из конвертера вместо «свадьба-в-усадьбе-ушмор», без `/` в конце).
3. Снова **Redeploy** (Production).

Браузер при открытии https://свадьба-в-усадьбе-ушмор.рф всё равно получит тот же сайт; ассеты могут пойти по punycode-URL — это нормально и часто стабилизирует загрузку.

---

Если ресурсы всё равно не грузятся, проверьте пункты ниже.

## 1. Куда реально ведёт кастомный домен

Кастомный домен должен обслуживаться **тем же Vercel-проектом**. Иначе браузер получает HTML с одного места, а запросы к `/_next/static/...` уходят не туда и падают с 404 или не доходят.

- В **Vercel**: Project → **Settings** → **Domains** — там должен быть ваш кастомный домен (например `усадьба-на-пре.рф` или punycode `xn------5cdacdecesgo3h4a6abi1bg9h6cj.xn--p1ai`).
- В **DNS** у регистратора домена:
  - либо **CNAME** запись на значение, которое показывает Vercel для этого домена (часто `cname.vercel-dns.com`),  
  - либо **A**-записи на IP, которые указаны в настройках домена в Vercel.

Если кастомный домен указывает на **другой сервер** (свой хостинг, прокси, CDN), а не на Vercel, то этот сервер должен **проксировать все пути** (включая `/_next/*` и `/static/*`) на ваш Vercel-деплой. Иначе ассеты с кастомного домена грузиться не будут.

## 2. Что проверить в браузере

На странице кастомного домена откройте **Инструменты разработчика** (F12) → вкладка **Сеть (Network)**. Обновите страницу и посмотрите:

- Запросы к `/_next/static/...` — с какого URL идут (должен быть ваш кастомный домен) и какой ответ (200, 404, CORS и т.п.).
- Если в столбце «Запрос» виден **другой хост** (например `xxx.vercel.app`) — значит, HTML отдаётся с кастомного домена, а ассеты подставляются с другого; тогда стоит проверить, не задан ли где-то `assetPrefix` или базовый URL под другой домен.
- Если запросы к `/_next/static/...` идут на кастомный домен, но приходят **404** — запросы до Vercel не доходят (прокси/хостинг режет пути или отдаёт не тот проект).

## 4. Что сделано в проекте

- В **next.config.ts** при заданной **NEXT_PUBLIC_SITE_URL** используется `assetPrefix`: стили и скрипты запрашиваются с этого домена.
- В **vercel.json** для `/_next/static/*` заданы заголовки кэширования.
- Для SEO и шаринга в **lib/site.ts** используется та же переменная **NEXT_PUBLIC_SITE_URL** (без слэша в конце).

После правок DNS или прокси подождите 5–15 минут и сделайте жёсткое обновление страницы (Ctrl+F5 / Cmd+Shift+R).
